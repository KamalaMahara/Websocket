<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
 <div class="max-w-md mx-auto bg-white shadow-lg rounded-lg overflow-hidden mt-16">
    <div class="px-4 py-2">
        <h1 class="text-gray-800 font-bold text-2xl uppercase">To-Do List</h1>
    </div>
    <form id="todoForm" class="w-full max-w-sm mx-auto px-4 py-2">
        <div class="flex items-center border-b-2 border-teal-500 py-2">
            <input id="newTask"
                class="appearance-none bg-transparent border-none w-full text-gray-700 mr-3 py-1 px-2 leading-tight focus:outline-none"
                type="text" placeholder="Add a task">
            <button
                class="flex-shrink-0 bg-teal-500 hover:bg-teal-700 border-teal-500 hover:border-teal-700 text-sm border-4 text-white py-1 px-2 rounded"
                type="submit">
                Add
            </button>
        </div>
    </form>
    <ul id="todoList" class="divide-y divide-gray-200 px-4">
        <li class="py-4">
            <div class="flex items-center">
                <input id="todo1" name="todo1" type="checkbox"
                    class="h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded">
                <label for="todo1" class="ml-3 block text-gray-900">
                    <span class="text-lg font-medium">Finish project proposal</span>
                    <span class="text-sm font-light text-gray-500">Due on 4/1/23</span>
                </label>
            </div>
        </li>
       
    </ul>
</div>
<script>
   const socket = io();
    socket.emit("fetchTodos");
   socket.on("todo_updated", (data) => {
    if(data.status === "success"){
      updateTodoList(data.data)
    }
    else{
      alert("failed to fetch todos")
    }
   });
    
   function updateTodoList(todos ) {
      document.getElementById("todoList").innerHTML = ""
      todos.forEach(todo => {
        const listItem = `<li class="py-4 flex items-center  justify-between ">
            <div class="flex items-center">
                <input id="todo_${todo._id}" name="todo${todo._id}" type="checkbox"
                    class="h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded" onchange="toggleStatus('${todo._id}', this.checked)">
                <label for="todo_${todo._id}" class="ml-3 block text-gray-900">
                    <span class="text-lg font-medium">${todo.task}</span>
                    <span class="text-sm font-light text-gray-500">Due on ${todo.deadline}</span>
                </label>
                
  
            </div>
            <button onclick=deleteTodo('${todo._id}') class="text-red-500 hover:text-red-700">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/> <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                  </button>
        </li>`
        document.getElementById("todoList").insertAdjacentHTML("beforeend", listItem)  
        
      });
   }
   document.getElementById("todoForm").addEventListener("submit", addTodo);
  
function addTodo(e){
   e.preventDefault();
  const taskValue = document.getElementById("newTask")
  const task = taskValue.value
  socket.emit("addTodo",{ task:task, deadline : new Date() .toLocaleDateString(),
    status:"pending"
  });
  taskValue.value = ""
}

function deleteTodo(id){
  socket.emit("deleteTodo",{ id:id });
}

function toggleStatus(id, isChecked){
  const status = isChecked ? "completed" : "pending"
  socket.emit("updateTodoStatus",{ id:id, status:status });
}
</script>
</body>

</html>